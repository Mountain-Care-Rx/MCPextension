(()=>{var o=typeof browser<"u"?browser:chrome;document.addEventListener("DOMContentLoaded",()=>{let t=document.querySelector(".info");if(t){let e=d();t.textContent=`CRM+ Extension v1.0b (${e})`}let r=document.getElementById("headerVisibilityToggle");r?(i(e=>{console.log("Current header visibility:",e),r.checked=e}),r.addEventListener("change",()=>{let e=r.checked;console.log("Toggle changed to:",e),c(e)})):console.error("Header visibility toggle not found in popup")});function i(t){o.tabs.query({active:!0,currentWindow:!0},r=>{if(!r||r.length===0){console.error("No active tab found."),t(!0);return}o.scripting.executeScript({target:{tabId:r[0].id},function:()=>{let e=localStorage.getItem("crmplus_headerBarVisible")!=="false",n=document.getElementById("mcp-crm-header");return n?n.style.display!=="none":e}}).then(e=>{e&&e[0]&&typeof e[0].result=="boolean"?t(e[0].result):t(!0)}).catch(()=>{t(!0)})})}function c(t){console.log("Applying header visibility:",t),o.tabs.query({active:!0,currentWindow:!0},r=>{if(!r||r.length===0){console.error("No active tab found.");return}o.scripting.executeScript({target:{tabId:r[0].id},function:e=>{localStorage.setItem("crmplus_headerBarVisible",e.toString());let n=document.getElementById("mcp-crm-header");return n?(n.style.display=e?"flex":"none",document.body.style.paddingTop=e?"32px":"0",!0):!1},args:[t]}).catch(e=>{console.error("Error executing script:",e),o.tabs.sendMessage(r[0].id,{action:"toggleHeaderVisibility",isVisible:t})})})}function d(){let t=navigator.userAgent;return t.includes("Firefox")?"Firefox":t.includes("Edg")?"Edge":"Chrome"}})();
